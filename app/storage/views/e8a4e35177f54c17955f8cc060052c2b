<?php $__env->startSection('content'); ?>
    <div class="portlet light bordered">
        <div class="portlet-title">
            <div class="caption">
                <?php $parameters = Input::all(); $parameters['export']='excel'; ?>
                <i class="fa fa-cogs"></i>Complete Report For Workid: <?php echo Input::get('WorkId'); ?> &nbsp;&nbsp;<?php if(!Input::has('export')): ?> <?php $parameters['export'] = 'print'; ?><a href="<?php echo route('etoolrpt.evaluationdetails',$parameters); ?>" class="btn btn-sm purple" target="_blank"><i class="fa fa-print"></i> Print</a><?php endif; ?>
            </div>
        </div>
        <div class="portlet-body flip-scroll">
            <?php if(Input::get('export')!='print'): ?>
            <?php echo Form::open(array('url'=>Request::url(),'method'=>'get')); ?>

            <div class="form-body">
                <div class="row">
                    <div class="col-md-3">
                        <div class="form-group">
                            <label class="control-label">Work Id</label>
                            <input type="text" class="form-control input-sm" name="WorkId" value="<?php echo Input::get('WorkId'); ?>"/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <label class="control-label">&nbsp;</label>
                        <div class="btn-set">
                            <button type="submit" class="btn blue-hoki btn-sm">Search</button>
                            <a href="<?php echo Request::url(); ?>" class="btn grey-cascade btn-sm">Clear</a>
                        </div>
                    </div>
                </div>
            </div>
            <?php echo Form::close(); ?>

            <?php endif; ?>
            <?php if(isset($tenderDetails[0]->TenderId) && $tenderDetails[0]->TenderId): ?>
            <h4 class="bold">Work Details</h4>
            <table class="table table-bordered table-condensed">
                <tbody>
                    <?php foreach($tenderDetails as $tenderDetail): ?>
                        <tr>
                            <td class="bold text-right">Name of work:</td>
                            <td><?php echo $tenderDetail->NameOfWork; ?></td>
                            <td class="bold text-right">Work ID:</td>
                            <td><?php echo $tenderDetail->WorkId; ?></td>
                            <td class="bold text-right">Procuring Agency:</td>
                            <td><?php echo $tenderDetail->ProcuringAgency; ?></td>
                            <td class="bold text-right">Class & Category:</td>
                            <td><?php echo $tenderDetail->Classification.", ".$tenderDetail->Category; ?></td>
                        </tr>
                        <tr>
                            <td class="bold text-right">Dzongkhag:</td>
                            <td><?php echo $tenderDetail->Dzongkhag; ?></td>
                            <td class="bold text-right">Estimated Project Cost:</td>
                            <td><?php echo $tenderDetail->ProjectEstimateCost; ?></td>
                            <td class="bold text-right">Contract Period:</td>
                            <td><?php echo $tenderDetail->ContractPeriod." month(s)"; ?></td>
                            <td></td>
                            <td></td>
                        </tr>
                    <?php endforeach; ?>
                </tbody>
            </table>
            <h4 class="bold">Equipment Criteria</h4>
            <table class="table table-bordered table-condensed">
                <thead>
                    <tr>
                        <th>Sl.No.</th>
                        <th>Tier</th>
                        <th>Equipment Name</th>
                        <th>No of Equipment</th>
                        <th>Equipment Point</th>
                    </tr>
                </thead>
                <tbody>
                    <?php $count = 1; ?>
                    <?php foreach($eqCriteria as $equipmentCriteria): ?>
                    <tr>
                        <td><?php echo $count; ?></td>
                        <td><?php echo $equipmentCriteria->Tier; ?></td>
                        <td><?php echo $equipmentCriteria->Equipment; ?></td>
                        <td><?php echo $equipmentCriteria->Quantity; ?></td>
                        <td><?php echo $equipmentCriteria->Points; ?></td>
                    </tr>
                    <?php $count++; ?>
                    <?php endforeach; ?>
                </tbody>
            </table>

            <h4 class="bold">Human Resource Criteria</h4>
            <table class="table table-bordered table-condensed">
                <thead>
                <tr>
                    <th>Sl.No.</th>
                    <th>Tier</th>
                    <th>Name</th>
                    <th>Qualification</th>
                    <th>Point</th>
                </tr>
                </thead>
                <tbody>
                <?php $count = 1; ?>
                <?php foreach($hrCriteria as $humanResourceCriteria): ?>
                    <tr>
                        <td><?php echo $count; ?></td>
                        <td><?php echo $humanResourceCriteria->Tier; ?></td>
                        <td><?php echo $humanResourceCriteria->Designation; ?></td>
                        <td><?php echo $humanResourceCriteria->Qualification; ?></td>
                        <td><?php echo $humanResourceCriteria->Points; ?></td>
                    </tr>
                    <?php $count++; ?>
                <?php endforeach; ?>
                </tbody>
            </table>

            <h4 class="bold">Individuals Equipment Details</h4>
                <?php foreach($bidContractors as $bidContractor): ?>
                    <table class="table table-condensed table-bordered">
                        <thead>
                            <tr style="border-bottom: 1px solid #DDDDDD;">
                                <th>CDB No.: </th>
                                <th colspan="5"><?php echo $cdbNos[$bidContractor->Id][0]->CDBNo; ?> <?php if($bidContractor->JointVenture == 1): ?><?php echo "(Joint Venture)"; ?><?php endif; ?></th>
                            </tr>
                            <tr>
                                <th>Sl.No.</th>
                                <th>Equipment Name</th>
                                <th>Registration No.</th>
                                <th>Tier</th>
                                <th>Type</th>
                                <th>Point</th>
                            </tr>
                        </thead>
                        <tbody>
                            <?php $count = 1; ?>
                            <?php foreach($contractorEquipments[$bidContractor->Id] as $contractorEquipment): ?>
                                <tr>
                                    <td><?php echo $count; ?></td>
                                    <td><?php echo $contractorEquipment->Equipment; ?></td>
                                    <td><?php echo $contractorEquipment->RegistrationNo; ?></td>
                                    <td><?php echo $contractorEquipment->Tier; ?></td>
                                    <td><?php echo ($contractorEquipment->OwnedOrHired == 2)?"Hired":"Owned"; ?></td>
                                    <td><?php echo $contractorEquipment->Points; ?></td>
                                </tr>
                                <?php $count++; ?>
                            <?php endforeach; ?>
                        </tbody>
                    </table>
                <?php endforeach; ?>

                <h4 class="bold">Individuals Human Resource Details</h4>
                <?php foreach($bidContractors as $bidContractor): ?>
                    <table class="table table-condensed table-bordered">
                        <thead>
                        <tr style="border-bottom: 1px solid #DDDDDD;">
                            <th>CDB No.: </th>
                            <th colspan="5"><?php echo $cdbNos[$bidContractor->Id][0]->CDBNo; ?> <?php if($bidContractor->JointVenture == 1): ?><?php echo "(Joint Venture)"; ?><?php endif; ?></th>
                        </tr>
                        <tr>
                            <th>Sl.No.</th>
                            <th>Designation</th>
                            <th>HR Name</th>
                            <th>CID No.</th>
                            <th>Qualification</th>
                            <th>Tier</th>
                            <th>Point</th>
                        </tr>
                        </thead>
                        <tbody>
                        <?php $count = 1; ?>
                        <?php foreach($contractorHRs[$bidContractor->Id] as $contractorHR): ?>
                            <tr>
                                <td><?php echo $count; ?></td>
                                <td><?php echo $contractorHR->Designation; ?></td>
                                <td><?php echo $contractorHR->Name; ?></td>
                                <td><?php echo $contractorHR->CIDNo; ?></td>
                                <td><?php echo $contractorHR->Qualification; ?></td>
                                <td><?php echo $contractorHR->Tier; ?></td>
                                <td><?php echo $contractorHR->Points; ?></td>
                            </tr>
                            <?php $count++; ?>
                        <?php endforeach; ?>
                        </tbody>
                    </table>
                <?php endforeach; ?>
                <h4 class="bold">Contractor Details</h4>
                <?php $count = 1; ?>
                <?php foreach($bidContractors as $bidContractor): ?>
                    <?php
                        $technicalScore = $contractorScores[$bidContractor->Id][0]->Score1+$contractorScores[$bidContractor->Id][0]->Score2+$contractorScores[$bidContractor->Id][0]->Score3+$contractorScores[$bidContractor->Id][0]->Score4+$contractorScores[$bidContractor->Id][0]->Score5+$contractorScores[$bidContractor->Id][0]->Score6;
                        $preferenceScore = ($contractorScores[$bidContractor->Id][0]->Score7+$contractorScores[$bidContractor->Id][0]->Score8+$contractorScores[$bidContractor->Id][0]->Score9)/10;
                        $financialScore = ($technicalScore>=$qualifyingScore)?(90 * ($lowestBid/$contractorAmounts[$bidContractor->Id][0]->FinancialBidQuoted)):0;
                        $grandTotal = ($technicalScore>=$qualifyingScore)?($financialScore + $preferenceScore):0;
                    ?>
                    <table class="table table-bordered table-condensed">
                        <tbody>
                            <tr>
                                <td class="bold">CDB No.</td>
                                <td colspan="2" style="font-size: 13pt;"><?php echo $cdbNos[$bidContractor->Id][0]->CDBNo; ?> <?php if($bidContractor->JointVenture == 1): ?><?php echo "(Joint Venture)"; ?><?php endif; ?></td>
                            </tr>
                            <tr>
                                <td rowspan="4" class="bold">Capability</td>
                                <td>Similar Work Experience</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score1; ?></td>
                            </tr>
                            <tr>
                                <td>Access to adequate equipment</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score2; ?></td>
                            </tr>
                            <tr>
                                <td>Availability of skilled manpower</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score3; ?></td>
                            </tr>
                            <tr>
                                <td>Average performance score from previous work</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score4; ?></td>
                            </tr>

                            <tr>
                                <td rowspan="3" class="bold">Capacity</td>
                                <td>Bid Capacity</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score5; ?></td>
                            </tr>
                            <tr>
                                <td>Credit Line avaliable</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score6; ?></td>
                            </tr>
                            <tr>
                                <td class="bold text-right">Total</td>
                                <td><b><?php echo $contractorScores[$bidContractor->Id][0]->Score6+$contractorScores[$bidContractor->Id][0]->Score5+$contractorScores[$bidContractor->Id][0]->Score4+$contractorScores[$bidContractor->Id][0]->Score3+$contractorScores[$bidContractor->Id][0]->Score2+$contractorScores[$bidContractor->Id][0]->Score1; ?></b></td>
                            </tr>

                            <tr>
                                <td rowspan="4" class="bold">Preference Score</td>
                                <td>Status(incorporated, proprietorship, JV etc.)</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score7; ?></td>
                            </tr>
                            <tr>
                                <td>Employment of VTI Graduates/local skilled labour</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score8; ?></td>
                            </tr>
                            <tr>
                                <td>Commitment for internships to VIT graduates</td>
                                <td><?php echo $contractorScores[$bidContractor->Id][0]->Score9; ?></td>
                            </tr>
                            <tr>
                                <td class="bold text-right">Total</td>
                                <td><b><?php echo $contractorScores[$bidContractor->Id][0]->Score9+$contractorScores[$bidContractor->Id][0]->Score8+$contractorScores[$bidContractor->Id][0]->Score7; ?></b> (Out of 10% = <b><?php echo ($contractorScores[$bidContractor->Id][0]->Score9+$contractorScores[$bidContractor->Id][0]->Score8+$contractorScores[$bidContractor->Id][0]->Score7)/10; ?></b>)</td>
                            </tr>

                            <tr>
                                <td rowspan="4" class="bold">Financial</td>
                                <td>Quoted Amount</td>
                                <td><?php echo $contractorAmounts[$bidContractor->Id][0]->FinancialBidQuoted; ?></td>
                            </tr>
                            <tr>
                                <td>Negotiated Amount</td>
                                <td><?php echo $contractorAmounts[$bidContractor->Id][0]->ContractPriceFinal; ?></td>
                            </tr>
                            <tr>
                                <td>(+)(-) Estimation %</td>
                                <td><?php echo round((($contractorAmounts[$bidContractor->Id][0]->Amount-$tenderDetail->ProjectEstimateCost)/$tenderDetail->ProjectEstimateCost * 100),2); ?></td>
                            </tr>
                            <tr>
                                <td class="bold text-right">Financial Score</td>
                                <td class="bold"><?php echo number_format($financialScore,2); ?></td>
                            </tr>
                            <tr>
                                <td rowspan="2" class="bold">Result</td>
                                <td class="bold text-right">Grand Total</td>
                                <td class="bold"><?php echo number_format($grandTotal,2); ?></td>
                            </tr>
                            <tr>
                                <td class="bold text-right">Status</td>
                                <td class="bold">
                                    <?php if(!empty($contractorStatuses[$bidContractor->Id])): ?>
                                        <?php if(($contractorStatuses[$bidContractor->Id][0]->AwardedAmount != NULL)&& ($contractorStatuses[$bidContractor->Id][0]->AwardedAmount>0)): ?><?php echo $tenderDetails[0]->Status; ?><?php else: ?> <?php if($contractorScores[$bidContractor->Id][0]->Score10 == 0.00): ?><?php echo "Not Qualified"; ?><?php else: ?><?php echo "H$count"; ?><?php endif; ?> <?php endif; ?>
                                    <?php else: ?>
                                        <?php if($contractorScores[$bidContractor->Id][0]->Score10 == 0.00): ?><?php echo "Not Qualified"; ?><?php else: ?><?php echo "H$count"; ?><?php endif; ?>
                                    <?php endif; ?>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                    <?php $count++; ?>
                <?php endforeach; ?>
            <?php endif; ?>
        </div>
    </div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('reportsmaster', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>