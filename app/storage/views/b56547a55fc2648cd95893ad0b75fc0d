<?php $__env->startSection('pagescripts'); ?>
    <?php echo HTML::script('assets/global/scripts/report.js'); ?>

    <?php echo HTML::script('assets/global/scripts/etool.js'); ?>

<?php $__env->stopSection(); ?>
<?php $__env->startSection('content'); ?>
    <input type="hidden" name="URL" value="<?php echo CONST_APACHESITELINK; ?>"/>
    <div class="portlet light bordered">
        <div class="portlet-title">
            <div class="caption">
                <?php $parameters = Input::all(); $parameters['export']='excel'; ?>
                <i class="fa fa-cogs"></i>Contractor's work in hand &nbsp;&nbsp;<?php if(!Input::has('export')): ?> <a href="<?php echo route('etoolrpt.contractorworkinhand',$parameters); ?>" class="btn btn-sm green"><i class="fa fa-file-excel-o"></i> Export to Excel</a>    <?php $parameters['export'] = 'print'; ?><a href="<?php echo route('etoolrpt.contractorworkinhand',$parameters); ?>" class="btn btn-sm purple" target="_blank"><i class="fa fa-print"></i> Print</a><?php endif; ?>
            </div>
        </div>
        <div class="portlet-body flip-scroll">
            <?php if(Input::get('export')!="print"): ?>
            <?php echo Form::open(array('url'=>Request::url(),'method'=>'get')); ?>

            <div class="form-body">
                <div class="row">
                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="control-label" for="cdbno">CDB No.:</label>
                            <input class="form-control" id="cdbno" type="text" class="cdbno" name="CDBNo" value="<?php echo Input::get('CDBNo'); ?>"/>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label class="control-label" for="ContractorName">Contractor:</label>
                            <input type="hidden" name="CrpContractorFinalId" class="contractor-id"/>
                            <input type="text" id="ContractorName" class="contractorName form-control contractor-name"/>
                        </div>
                    </div>
                    <?php if(!Input::has('export')): ?>
                        <div class="col-md-2">
                            <label class="control-label">&nbsp;</label>
                            <div class="btn-set">
                                <button type="submit" class="btn blue-hoki btn-sm">Search</button>
                                <a href="<?php echo Request::url(); ?>" class="btn grey-cascade btn-sm">Clear</a>
                            </div>
                        </div>
                    <?php endif; ?>
                </div>
            </div>
            <?php echo Form::close(); ?>

            <?php else: ?>
                <?php foreach(Input::all() as $key=>$value): ?>
                    <?php if($key != 'export'): ?>
                        <b><?php echo $key; ?>: <?php echo $value; ?></b><br>
                    <?php endif; ?>
                <?php endforeach; ?>
                <br/>
            <?php endif; ?>
            <?php $__empty_1 = true; foreach($singleContractor as $value): $__empty_1 = false; ?>
            <div class="row">
                <div class="col-md-12">
                    <table class="table table-condensed table-bordered">
                        <tbody>
                            <tr>
                                <td colspan="2" class="text-right"><strong>Name of Firm:</strong></td>
                                <td colspan="6"> <?php echo $value->NameOfFirm; ?></td>
                            </tr>
                            <tr>
                                <td colspan="2" class="text-right"><strong>CDB No.:</strong></td>
                                <td colspan="6"> <?php echo $value->CDBNo; ?></td>
                            </tr>
                            <tr>
                                <td class="text-right"><strong>W1:</strong></td>
                                <td> <?php echo $value->Classification1; ?></td>
                                <td class="text-right"><strong>W2:</strong></td>
                                <td> <?php echo $value->Classification2; ?></td>
                                <td class="text-right"><strong>W3:</strong></td>
                                <td> <?php echo $value->Classification3; ?></td>
                                <td class="text-right"><strong>W4:</strong></td>
                                <td> <?php echo $value->Classification4; ?></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <?php endforeach; if ($__empty_1): ?>
            <?php endif; ?>

            <div class="table-responsive">
                <table class="table table-bordered table-striped table-condensed flip-content" id="">
                    <thead class="flip-content">
                        <tr>
                            <th>Sl.No.</th>
                            <th>Year</th>
                            <th>Agency</th>
                            <th>Work Id</th>
                            <th>Work Name</th>
                            <th>Category</th>
                            <th>Awarded Amount</th>
                            <th>Final Amount</th>
                            <th>Dzongkhag</th>
                            <th>Status</th>
                            <th>APS scoring</th>
                            <th>APS (100)</th>
                            <th>Remarks</th>
                        </tr>
                    </thead>
                    <tbody>
                    <?php $count = 1; $awardedAmount = 0;?>
                    <?php $__empty_1 = true; foreach($workDetails as $workDetail): $__empty_1 = false; ?>
                        <tr>
                            <td><?php echo $count; ?></td>
                            <td><?php echo $workDetail->Year; ?></td>
                            <td><?php echo $workDetail->Agency; ?></td>
                            <td><?php echo $workDetail->WorkId; ?></td>
                            <td><?php echo strip_tags($workDetail->NameOfWork); ?></td>
                            <td><?php echo $workDetail->Category; ?></td>
                            <td><?php echo $workDetail->AwardedAmount; ?></td>
                            <td><?php echo $workDetail->FinalAmount; ?></td>
                            <td><?php echo $workDetail->Dzongkhag; ?></td>
                            <td><?php echo $workDetail->Status; ?><?php $awardedAmount+=($workDetail->ReferenceNo == 3001)?1:0;?></td>
                            <td>
                                <?php if((int)$workDetail->APS == 100) {
                                            $points = 10;
                                        }
                                        if(((int)$workDetail->APS < 100) && ((int)$workDetail->APS >= 50)) {
                                            $points = 10 - (ceil((100 - (int)$workDetail->APS) / 5));
                                        }
                                        if((int)$workDetail->APS < 50){
                                            $points = 0;
                                        }
                                ?>
                                <?php echo $points; ?>

                            </td>
                            <td><?php echo $workDetail->APS; ?></td>
                            <td><?php echo $workDetail->Remarks; ?></td>
                        </tr>
                        <?php $count++ ?>
                    <?php endforeach; if ($__empty_1): ?>
                        <tr><td colspan="12" class="font-red text-center">No data to display</td></tr>
                    <?php endif; ?>
                    </tbody>
                </table>
            </div>
            <?php if(!empty($workDetails)): ?>
                <h5><strong>No. of Works in Hand: </strong><?php echo $awardedAmount; ?></h5>
            <?php endif; ?>
                <b>Note: </b>The information on track records/status of works are by no means up to date and hence the attached information are only those that the Secretariat could collect and compile. We urge you to verify with the procuring agencies concerned for complete list of works in hand/or its status.
        </div>
    </div>
<?php $__env->stopSection(); ?>
<?php echo $__env->make('reportsmaster', array_except(get_defined_vars(), array('__data', '__path')))->render(); ?>